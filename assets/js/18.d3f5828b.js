(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{431:function(e,s,n){"use strict";n.r(s);var a=n(3),t=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"前情提要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前情提要"}},[e._v("#")]),e._v(" 前情提要")]),e._v(" "),s("p",[e._v("先说Docker，就下载"),s("a",{attrs:{href:"https://www.docker.com/products/docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-desktop"),s("OutboundLink")],1),e._v("安装就好了。")]),e._v(" "),s("p",[e._v("这里就有一个问题了，docker-desktop也自带了一个kubernetes。但是，建议玩家还是根据k8s的安装文档来安装一下kubernetes。为什么呢？因为docker-desktop自带的kubernetes因各种版本问题，配置运行起来非常麻烦，还不自带dashboard，还是minikube可玩儿性比较高。 根据k8s的官方文档搭建学习环境，就是"),s("a",{attrs:{href:"https://kubernetes.io/zh/docs/setup/learning-environment/minikube/",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用 Minikube 安装 Kubernetes"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("在安装Minikube的说明文档里，其实还要安装一个kubernetes 的 cli工具"),s("code",[e._v("kubectl")]),e._v("。当然如果使用"),s("code",[e._v("brew")]),e._v("来安装Minikube的时候，"),s("code",[e._v("kubectl")]),e._v("是"),s("code",[e._v("minikube")]),e._v("的依赖，因此可以直接安装"),s("code",[e._v("minikube")]),e._v("，"),s("code",[e._v("brew")]),e._v("会自动安装依赖"),s("code",[e._v("kubectl")]),e._v("。")]),e._v(" "),s("blockquote",[s("p",[e._v("另外，部分资源的下载，如果不翻墙的话可能会非常慢甚至下载不下来。")])]),e._v(" "),s("h2",{attrs:{id:"安装kubectl-和-minikube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装kubectl-和-minikube"}},[e._v("#")]),e._v(" 安装kubectl 和 Minikube")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("brew "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" kubectl "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 或者 brew install kubernetes-cli")]),e._v("\nbrew "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" minikube\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),e._v(" "),s("blockquote",[s("p",[e._v("如果之前启用过docker-desktop里的k8s，使用以下命令能查看，如果发现软链指向的是docker应用目录，删除软链就好了。")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-l")]),e._v(" /usr/local/bin/kubectl\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])])]),e._v(" "),s("h2",{attrs:{id:"启动minikube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动minikube"}},[e._v("#")]),e._v(" 启动minikube")]),e._v(" "),s("p",[e._v("安装完成之后，可以启动一下minikube试试:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("minikube start\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("会发现它会自动选择一个驱动。虽然我docker-desktop已安装并且运行，virtualbox和VMware都安装了，但是它仍然自动选择了"),s("code",[e._v("hyperkit")]),e._v("。然后自己下载"),s("code",[e._v("hyperkit")]),e._v("的驱动了。试验发现，当安装了docker-desktop或者使用brew安装了hyperkit后，如是不指定驱动，它会默认使用 hyperkit 驱动。更多的驱动，可以看官方文档："),s("a",{attrs:{href:"https://minikube.sigs.k8s.io/docs/drivers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Drivers"),s("OutboundLink")],1)]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ minikube start\n😄  Darwin 10.15.4 上的 minikube v1.9.2\n✨  Automatically selected the hyperkit driver. Other choices: docker, virtualbox, vmwarefusion\n💾  正在下载驱动 docker-machine-driver-hyperkit:\n    > docker-machine-driver-hyperkit.sha256: 65 B / 65 B [---] 100.00% ? p/s 0s\n    > docker-machine-driver-hyperkit: 10.90 MiB / 10.90 MiB  100.00% 3.80 MiB p\n🔑  The 'hyperkit' driver requires elevated permissions. The following commands will be executed:\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("然后要一次密码，输入后继续，因为我嫌下载驱动太慢，命令行使用了代理，导致启动失败，提示正在使用代理，但是未将 192.168.64.* ip段加入NO_PROXY列表。所以新开一个窗口继续（命令行就没代理了）")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('$ minikube start\n  Darwin 10.15.4 上的 minikube v1.9.2\n✨  根据现有的配置文件使用 hyperkit 驱动程序\n👍  Starting control plane node m01 in cluster minikube\n🏃  Updating the running hyperkit "minikube" VM ...\n🐳  正在 Docker 19.03.8 中准备 Kubernetes v1.18.0…\n❗  This VM is having trouble accessing https://k8s.gcr.io\n💡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/\n🌟  Enabling addons: default-storageclass, storage-provisioner\n🏄  完成！kubectl 已经配置至 "minikube"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[e._v("可以发现它自动创建了kubectl的配置文件，在"),s("code",[e._v("~/.kube/")]),e._v("目录下生成了一个"),s("code",[e._v("config")]),e._v("文件。同时"),s("code",[e._v("minikube")]),e._v("的配置文件位置在"),s("code",[e._v("~/.minikube")]),e._v("。")]),e._v(" "),s("p",[e._v("然后检查一下状态")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ minikube status\nm01\nhost: Running\nkubelet: Running\napiserver: Running\nkubeconfig: Configured\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("如果要看一下dashboard，命令行执行")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("minikube dashboard\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("它会开启一个dashboard服务，同时自动调用浏览器打开一个窗口，可以看到kubernetes的一些情况。")]),e._v(" "),s("p",[e._v("到这里，一个最基本的minikube安装过程就完成了。 非常easy吧。")]),e._v(" "),s("p",[e._v('这时候再看docker-desktop的菜单，会出现“Kubernetes”，里面会增加选项"minikube"。')]),e._v(" "),s("h2",{attrs:{id:"小技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小技巧"}},[e._v("#")]),e._v(" 小技巧")]),e._v(" "),s("p",[e._v("如果使用zsh（MacOs catalina已经默认使用zsh了），并且同时使用了"),s("a",{attrs:{href:"http://ohmyz.sh/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Oh-My-Zsh"),s("OutboundLink")],1),e._v("，可以直接在"),s("code",[e._v("~/.zshrc")]),e._v("中编辑plugins=来增加kubectl的命令行快速补全插件，例如我的plugins内容（多个插件以空格隔开)：")]),e._v(" "),s("div",{staticClass:"language-ini line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("plugins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("(git git-flow brew mvn z jenv kubectl)")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("更多内容参考 "),s("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/tools/install-kubectl/",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装并设置 kubectl"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("后面再介绍一些配置相关的内容。今天先到这里啦。")])])}),[],!1,null,null,null);s.default=t.exports}}]);