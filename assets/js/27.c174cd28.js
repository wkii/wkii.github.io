(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{440:function(t,n,e){"use strict";e.r(n);var a=e(3),o=Object(a.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("困扰了我一天的问题。首先是Mongodb副本集。查php的Mongo扩展手册把副本集搞定。然后又是长整型时间的问题。 存进mongo的是java的长整型时间戳。而php是弱类型语言，且php的时间戳是11位。目前还是10位的阶段。转换成java的时间戳需要在后面补零。")]),t._v(" "),n("p",[t._v("// 生成java时间戳")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$time = (string)$time.'000';\n$time = (int)$time;\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("但是查询结果根本没有数据。把框架的Mongo用Debug打印出查询语句，没有问题。把查询语句直接在shell里查也没问题。但就是没数据。 后来打开Mongo的日志，调整级别为5，这样会记录查询语句。参照"),n("a",{attrs:{href:"http://api.mongodb.org/wiki/current/setParameter%20Command.html",title:"mongo",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),n("OutboundLink")],1),t._v("。 发现我所查询的时间都变成了负数：“"),n("em",[t._v("{ $gt: -154503944 }")]),t._v("” 然后万能的google找到了答案。php的长整型需要使用MongoInt64这个类来转换一下。虽然你在php中输出结果是一样的，但查询起来就不一样了。那么在上面的语句后面再加上一句就对了。")]),t._v(" "),n("p",[t._v("// 必须的一步，将长整形使用MongoInt64转换成64位整型")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$time = new MongoInt64($time);\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("Mongo扩展的类参考在这里："),n("a",{attrs:{href:"http://www.php.net/manual/en/mongoint64.construct.php",title:"mongoint64",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.php.net/manual/en/mongoint64.construct.php"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=o.exports}}]);